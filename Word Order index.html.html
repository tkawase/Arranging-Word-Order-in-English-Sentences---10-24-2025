<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Word Order in English Sentences - 英文並び替え</title>
<script>
let qno;　// 問題番号
// 英文データ
const sentence = [["I have to do my homework.","私は宿題をしなければならない。"],
    ["I am not very good at cooking.","私は料理があまり上手ではない。"],
    ["May I have a piece of cake?","ケーキを一切れいただけますか？"],
    ["I think it will begin to rain soon.","すぐに雨が降り始めると思う。"],
    ["I looked for the book for an hour.","私はその本を1時間探した。"]];

const init = () => {
      //　問題開始
      shuffle(sentence);
      qno = 0;
      setQuestion();
      document.getElementById("num").innerText = `${qno+1}/${sentence.length}`;
}

const setQuestion = ()=> {
      //　問題の表示
      const question = `問${qno+1}) ${sentence[qno][1]}`;
      document.getElementById("question").innerHTML = question;
      //　選択欄、解答欄の作成
      let words = sentence[qno][0].slice(0,sentence[qno][0].length-1).split(" ");
      shuffle(words);
      document.getElementById("select").innerHTML = "";
      document.getElementById("answer").innerHTML = "";
      for (let i=0; i<words.length; i++) {
          //　選択欄
          const word = document.createElement("span");
          word.innerText = words[i];
          word.draggable = true;
          word.ondragstart = dragWord;
          document.getElementById("select").appendChild(word);
          //　解答欄
          const answer = document.createElement("span");
          answer.innerText = `(${i+1})`;
          answer.ondragover = dragOverWord;
          answer.ondragleave = dragLeaveWord;
          answer.ondrop = dropWord;
          answer.classList.add("reset");
          document.getElementById("answer").appendChild(answer); 
      }
      //　末尾（ピリオドなど）
      const last = document.createElement("span");
      last.innerText = sentence[qno][0].slice(-1);
      document.getElementById("answer").appendChild(last);
      document.getElementById("next").disabled = true; 
}

const dragWord = event => {
      //　単語をドラッグ
      event.dataTransfer.setData("text",event.target.innerText);
      event.target.classList.add("select");
}

const dropWord = event => {
      //　単語を解答欄にドロップ
      event.preventDefault();
      event.target.innerText = event.dataTransfer.getData("text");
      event.target.classList.remove("reset","select");
      event.target.classList.add("set");
}

const dragOverWord = event => {
      //　解答欄に選択中のスタイルをセット
      event.preventDefault();
      event.target.classList.add("select");
}

const dragLeaveWord = event => {
      //　選択中のスタイルを解答欄からすべて削除
      setStyle(document.getElementById("answer").children,"remove","select");
}
　　　　　　　　　　　　　　　　　　
const setStyle = (targetList,op,style1,style2 = null) => {
      //　スタイルの一括変更
     for  (const target of targetList) {　
          if (op == "add") target.classList.add(style1,style2);
          if (op == "remove") target.classList.remove(style1,style2);
     }
}

const shuffle = array => {
      //　配列の要素をシャッフル
      for (let i=array.length-1; i>0; i--)  {
      const j = Math.floor(Math.random() * i);
      [array[i],array[j]] = [array[j],array[i]];
    }
}

const checkAnswer = () => {
      //　正誤チェック
     const words = document.getElementById("answer").children;
     let answer = "";
     for (const word of words) {
          answer += word.innerText + " ";
     }
     const last = sentence[qno][0].slice(-1);
     let check = "ng";
     if  (answer.replace(` ${last} `,last) == sentence[qno][0])  {
         //　正解
         check = "ok";
         speechSentence();
         if (qno < sentence. length-1) {
            document.getElementById("next").disabled = false;
        }
      }
      setStyle(words,"remove","ok","ng");
      setStyle(words,"add",check);
}

const resetAnswer = () => {
   　//　解答欄をリセット
     setStyle(document.getElementById("select").children,"remove","select");
     const answers = document.getElementById("answer").children;
     setStyle(answers,"remove","ok","ng");
     for (let i=0; i<answers.length-1; i++) {
         answers[i].classList.remove("set"); 
         answers[i].classList.add("reset");
         answers[i].innerHTML = "("+(i+1)+")";
     }
}

const speechSentence = () => {
      //　英文を発声
      window.speechSynthesis.cancel();
      const utterance = new SpeechSynthesisUtterance();
      utterance.text = sentence[qno][0];
      utterance.lang = "en-US";
      window.speechSynthesis.speak(utterance);
}

const nextQuestion = () => {
      //　次の問題
      qno++;
      setQuestion();
      document.getElementById("num").innerText = `${qno+1}/${sentence.length}`;
}
</script>
<style>
div {height: 60px};
div span {
    margin: 5px;
    padding: 10px 10px;
    border: thin solid#0000CC;
    cursor: pointer;
}
.set {
    color:#000000;
    background-color:#CCFFFF;
}
.reset {color: #9999FF;}
.ok {background-color: #CCFFCC;}
.ng {background-color: #FFCCCC;}
.select {background-color: #99CCFF;}
</style>
</head>
<body onload="init()">
<p>Arranging Words in English Sentences - 英文並び替え</p>
<input type="button" value="はじめから" onclick="init()">
<input type="button" id="next" value="次の問題" onclick="nextQuestion()">
<span id="num">1/10</span>
<hr>
<div id="question"></div>
<div id="select"></div>
<div>   ↓ Arrange Words into Correct Order - 正しい順に並び変えてください。</div>
<div id="answer"></div>
<hr>
<input type="button" value="リセット" onclick="resetAnswer()">
<input type="button" value="判定" onclick="checkAnswer()">
<input type="button" value="ヒント" onclick="speechSentence()">
</body>
</html>

